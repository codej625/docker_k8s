# 인그레스 & 인그레스 컨트롤러

<br />
<br />

* 인그레스 & 인그레스 컨트롤러란?

---

```
쿠버네티스(Kubernetes) 환경에서,
외부 트래픽을 클러스터 내부의 서비스로 라우팅하고 관리하는 핵심 구성 요소이다.

현대적인 마이크로서비스 아키텍처에서 API Gateway/Reverse Proxy 역할을 수행한다고 이해하면 편하다.
```

<br />
<br />
<br />
<br />

1. Ingress (규칙, Resource Object)

```
Ingress는 쿠버네티스 클러스터 내의 서비스(Service)에 외부에서 접근할 수 있도록,
HTTP 및 HTTPS 라우팅 규칙을 정의하는 쿠버네티스 리소스이다.

주로 Layer 7 (L7, 애플리케이션 계층) 로드 밸런싱 규칙을 정의하는 데 사용한다.

(별도의 파드나 서비스가 없고 규칙을 적어놓은 문서라고 생각하면 편함)
```

<br />

| 사용자 요구사항       | Ingress를 통한 구현 방식                                                                                  |
|:----------------------|:-----------------------------------------------------------------------------------------------------------|
| **파드 추가 후 노출** | **Pod** -> **Service** -> **Ingress** 를 통해 클러스터 외부로 트래픽을 노출한다.                            |
| **도메인 연결**       | Ingress 리소스의 `host` 필드에 특정 도메인(예: `api.nextjs.com`)을 정의하여 해당 요청을 내부 서비스로 라우팅 |
| **리버스 프록시**     | **Ingress Controller** (예: Nginx, ALB)가 클라이언트와 내부 Service 사이에서 L7 리버스 프록시 역할을 수행    |
| **인증서 연결**       | `tls` 필드에서 **TLS Secret**을 참조하거나, **cert-manager**를 통해 인증서를 자동 발급받아 HTTPS 설정을 제공 |

<br />
<br />
<br />

2. Ingress Controller

```
Ingress 리소스에 정의된 규칙을 실제로 이행하는 것은 Ingress Controller라는 별도의 소프트웨어이다.

이 컨트롤러가 클러스터 외부와 서비스 사이에서 리버스 프록시 및 트래픽 라우팅을 담당한다.

Ingress Controller는 L7 로드 밸런서의 역할을 수행한다.
```

<br />

| Ingress Controller             | 기반 기술                            | 특징                                                                                                                  |
|:-------------------------------|:-------------------------------------|:----------------------------------------------------------------------------------------------------------------------|
| **Nginx Ingress Controller**   | Nginx                                | **가장 널리 사용**되며 안정성이 높습니다. 기능이 풍부하고 유연하지만, 설정(Config) 업데이트 시 재로딩(Reload)이 필요    |
| **Traefik**                    | Traefik Proxy                        | **동적 설정(Dynamic Configuration)** 에 특화되어 설정 업데이트가 매우 빠릅니다. 자동화 및 간결함을 중시하는 환경에 적합 |
| **HAProxy Ingress**            | HAProxy                              | 고성능 로드 밸런싱에 최적화되어 있으며, TCP/HTTP 계층 모두에서 강력한 기능을 제공                                       |
| **Cloud Provider Controllers** | AWS ALB/NLB, GCE L7 Load Balancer 등 | 클라우드 서비스 제공자가 제공하는 로드 밸런서를 사용 (클라우드와의 **통합 및 관리 용이성**이 높다)                      |

<br />
<br />
<br />

3. 작동 프로세스

| 단계     | 주체                   | 역할                                                                                             | 비고                             |
|:--------:|:----------------------:|:-------------------------------------------------------------------------------------------------|:---------------------------------|
| **정의** | **사용자**             | **Ingress** 오브젝트를 생성하여 L7 라우팅 **규칙** (호스트, 경로 등)을 작성하고 명시.             | Ingress 자체는 프로그램이 아님    |
| **실행** | **쿠버네티스**         | **Ingress Controller**를 (Deployment/DaemonSet으로) **파드** 형태로 클러스터 내부에 실행         | Nginx, Traefik, HAProxy 등        |
| **노출** | **네트워크 인프라**    | **LoadBalancer Service** (MetalLB 또는 클라우드 L4)를 통해 Ingress Controller 파드를 외부에 노출 | 외부 IP 주소 할당 및 광고         |
| **처리** | **Ingress Controller** | 외부 트래픽을 받아 Ingress 규칙을 적용하여 백엔드 **ClusterIP Service**로 **L7 라우팅**한다.      | 트래픽을 최종적으로 처리하는 주체 |
| **전달** | **`kube-proxy`**       | ClusterIP Service 규칙에 따라 트래픽을 해당 서비스의 백엔드 **파드**로 최종 전달한다.             | 내부 L4 로드 밸런싱               |
