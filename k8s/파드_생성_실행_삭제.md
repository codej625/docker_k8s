# 파드를 생성하고, 실행하고, 삭제해보자.

<br />
<br />

* 웹 서버(Nginx)를 파드(Pod)로 띄워보기

---

```
파드(Pod)를 생성할 때 CLI를 활용하는 방법이 있고,
yaml 파일을 활용하는 방법이 있다.

실제 현업에서는 yaml 파일을 활용하는 경우가 많다.

따라서 yaml 파일을 활용해서 파드(Pod)를 생성해볼 것이다.
```

<br />
<br />
<br />
<br />

1. yaml 파일 작성

<br />

`nginx-pod.yaml`

```yaml
apiVersion: v1 # Pod를 생성할 때는 v1이라고 기재한다. (공식 문서)
kind: Pod # Pod를 생성한다고 명시

metadata:
  name: nginx-pod # Pod에 이름 붙이는 기능

spec:
  containers:
    - name: nginx-container # 생성할 컨테이너의 이름
    image: nginx # 컨테이너를 생성할 때 사용할 Docker 이미지
    ports:
      - containerPort: 80 # 해당 컨테이너가 어떤 포트를 사용하는 지 명시적으로 표현 (정말 단순 명시..)
```

```
YAML 문법상 들여쓰기를 할 때 Tab을 사용하면 안 되고,
반드시 띄어쓰기를 활용해야 한다.
```

<br />
<br />
<br />

2. 파드 생성하기

```
# yaml 파일에 적혀져있는 리소스(파드)를 생성
$ kubectl apply -f nginx-pod.yaml (-f는 file을 뜻한다.)
```

<br />
<br />
<br />

3. 파드(Pod)가 잘 생성됐는 지 확인

```
# 파드(Pod) 조회
$ kubectl get pods
```

<br />

| NAME     | Pod의 이름                                      |
|----------|-----------------------------------------------|
| READY    | (파드 내 준비 완료된 컨테이너 수)/(파드 내 총 컨테이너 수) |
| STATUS   | 파드의 상태 ( Running : 정상적으로 실행 중)           |
| RESTARTS | 해당 파드의 컨테이너가 재시작된 횟수                   | 
| AGE      | 파드가 생성되어 실행된 시간                          |

<br />

```
쿠버네티스에서는 위에서 작성한 yaml 파일을 보고 매니페스트 파일(Manifest File)이라고 부른다.

이 매니페스트 파일은 쿠버네티스에서 다양한 리소스(파드, 서비스, 볼륨 등)를 생성하고,
관리하기 위해 사용하는 파일이라고 기억하자.
(Docker로 치면 Dockerfile과 같은 역할을 하는 파일)
```

<br />
<br />
<br />

4. 분명 파드(Pod)로 Nginx를 띄웠는 데 접속이 안 된다.

```
도커에 대해서 공부했을 때는 컨테이너 내부와 컨테이너 외부의 네트워크가 서로 독립적으로 분리되어 있다.

하지만 쿠버네티스에서는 "파드(Pod) 내부의 네트워크를 컨테이너가 공유"해서 같이 사용한다.
(파드(Pod)의 네트워크는 로컬 컴퓨터의 네트워크와는 독립적으로 분리되어 있다.)

이 때문에 파드(Pod)로 띄운 Nginx에 아무리 요청을 보내도 응답이 없던 것이다.
```

<br />

`Nginx가 띄우는 웹 페이지에 접근하려면 2가지 방법`

```
- 파드(Pod) 내부로 들어가서 접근하기

- 파드(Pod)의 내부 네트워크를 외부에서도 접속할 수 있도록 포트 포워딩(= 포트 연결시키기) 활용하기
```

<br />
<br />

`1) 파드(Pod) 내부로 들어가서 Nginx로 요청보내기`

```
# 도커에서 컨테이너로 접속하는 명령어(docker exec -it [컨테이너 ID] bash)와 비슷하다.
$ kubectl exec -it [파드명] -- bash

# nginx-pod 내부 환경으로 접속
$ kubectl exec -it nginx-pod -- bash

# Pod 내부
$ curl localhost:80 # Nginx로 요청보내기
```

```
쿠버네티스에서는 파드(Pod) 내부의 네트워크를 컨테이너가 공유해서 같이 사용하기 때문에,
파드로 접속해서 Nginx로 요청을 보냈을 때 정상적으로 응답이 날라온 것이다.
```

<br />

`2) 포트 포워딩을 활용해 Nginx로 요청보내기`

```
# sudo kubectl port-forward pod/[파드명] [로컬에서의 포트]:[파드에서의 포트]
$ sudo kubectl port-forward pod/nginx-pod 80:80
```

<br />
<br />
<br />

5. 파드 삭제하기

```
# kubectl delete pod [파드명]
$ kubectl delete pod nginx-pod # nginx-pod라는 파드 삭제

# 파드가 잘 삭제됐는 지 확인
$ kubectl get pods
```
